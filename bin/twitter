#!/usr/bin/env node

var OAuth     = require( 'oauth' ).OAuth;
var commander = require( 'commander' );
var key       = require( '../config.json' );

var twitterOAuth = new OAuth(
	'https://api.twitter.com/oauth/request_token',
	'https://api.twitter.com/oauth/access_token',
	key.consumer.key,
	key.consumer.secret,
	'1.0A',
	'oob',
	'HMAC-SHA1'
);

function getOAuth ( url, statement ) {
	twitterOAuth.get(
		url,
		key.token.key,
		key.token.secret,
		statement
	);
}

commander
	.version( '0.0.0' )

commander
	.command( 'hi' )
	.description( 'Prints hi' )
	.action( function() {
		console.log( 'Hi' );
	} );

commander
	.command( 'user' )
	.description( 'Shows user details' )
	.action( function () {
		getOAuth(
			'https://api.twitter.com/1.1/account/verify_credentials.json',
			function ( error, response, body ) {
				var data = JSON.parse( response );

				if ( error ) {
					console.log( error );
				}

				console.log( ' ----------------------------------------' );
				console.log( '|               User Details             |' );
				console.log( ' ----------------------------------------' );
				console.log( ' ----------------------------------------' );
				console.log( '  Full name         | ' + data.name );
				console.log( '  Screen name       | ' + data.screen_name );
				console.log( '  Tweets            | ' + data.statuses_count );
				console.log( '  Following         | ' + data.friends_count );
				console.log( '  Followers         | ' + data.followers_count );
				console.log( ' ----------------------------------------' );
			}
		);
	} );

commander
	.command( 'favorites' )
	.description( 'Displays recent favorited tweets' )
	.action( function () {
		getOAuth(
			'https://api.twitter.com/1.1/favorites/list.json',
			function ( error, response, body ) {
				var data = JSON.parse( response );

				if ( error ) {
					console.log( error );
				}

				for ( var x in data ) {
					console.log( data[ x ].user.name + ' [@' + data[ x ].user.screen_name + '], ' + data[ x ].created_at );
					console.log( data[ x ].text );
					console.log( '\n' );
				}
			}
		);
	} );

commander
	.command( 'fave [screen name]' )
	.description( 'Displays recent favorited tweets for the specified user' )
	.action( function ( screen_name ) {
		var url = 'https://api.twitter.com/1.1/favorites/list.json?screen_name=' + screen_name;
		getOAuth(
			url,
			function ( error, response, body ) {
				var data = JSON.parse( response );

				if ( error ) {
					console.log( error );
				}

				for ( var x in data ) {
					console.log( data[ x ].user.name + ' [@' + data[ x ].user.screen_name + '], ' + data[ x ].created_at );
					console.log( data[ x ].text );
					console.log( '\n' );
				}
			}
		);
	} );

commander.parse( process.argv );
