#!/usr/bin/env node

var commander = require( 'commander' );
var request   = require( 'request' );
var open      = require( 'open' );
var OAuth     = require( 'oauth' ).OAuth;
var key       = require( '../config.json' );

var twitterOAuth = new OAuth(
	'https://api.twitter.com/oauth/request_token',
	'https://api.twitter.com/oauth/access_token',
	key.consumer.key,
	key.consumer.secret,
	'1.0A',
	null,
	'HMAC-SHA1' );

commander
	.version( '0.0.0' )

commander
	.command( 'hi' )
	.description( 'Prints hi' )
	.action( function() {
		console.log( 'Hi' );
	} );

commander
	.command( 'oauth' )
	.description( 'Authenticates the application to use Twitter' )
	.action( function () {
		twitterOAuth.getOAuthRequestToken(
			function ( error, OAuthToken, OAuthSecret, results ) {
				var url = 'https://twitter.com/oauth/authenticate?oauth_token=' + OAuthToken;

				if ( error ) {
					console.log( error );
				} else {
					open( url );
				}
			} );
	} );

commander
	.command( 'pin [pin]' )
	.description( 'PIN entry' )
	.action( function ( OAuthPin ) {
		var url = 'https://twitter.com/oauth/access_token?oauth_verifier=' + OAuthPin;

		console.log( url );
	} );

commander.parse( process.argv );
